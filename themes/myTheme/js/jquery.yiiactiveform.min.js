(function(b){var a=function(e){var d,f=[];if(!e.length){return undefined}if(e[0].tagName.toLowerCase()==="span"){e.find(":checked").each(function(){f.push(this.value)});return f.join(",")}d=e.attr("type");if(d==="checkbox"||d==="radio"){return e.filter(":checked").val()}else{return e.val()}};b.fn.yiiactiveform=function(c){return this.each(function(){var e=b.extend({},b.fn.yiiactiveform.defaults,c||{}),d=b(this);if(e.validationUrl===undefined){e.validationUrl=d.attr("action")}b.each(e.attributes,function(h){this.value=a(d.find("#"+this.inputID));e.attributes[h]=b.extend({},{validationDelay:e.validationDelay,validateOnChange:e.validateOnChange,validateOnType:e.validateOnType,hideErrorMessage:e.hideErrorMessage,inputContainer:e.inputContainer,errorCssClass:e.errorCssClass,successCssClass:e.successCssClass,beforeValidateAttribute:e.beforeValidateAttribute,afterValidateAttribute:e.afterValidateAttribute,validatingCssClass:e.validatingCssClass},this)});d.data("settings",e);e.submitting=false;var g=function(i,h){if(h){i.status=2}b.each(e.attributes,function(){if(this.value!==a(d.find("#"+this.inputID))){this.status=2;h=true}});if(!h){return}if(e.timer!==undefined){clearTimeout(e.timer)}e.timer=setTimeout(function(){if(e.submitting||d.is(":hidden")){return}if(i.beforeValidateAttribute===undefined||i.beforeValidateAttribute(d,i)){b.each(e.attributes,function(){if(this.status===2){this.status=3;b.fn.yiiactiveform.getInputContainer(this,d).addClass(this.validatingCssClass)}});b.fn.yiiactiveform.validate(d,function(k){var j=false;b.each(e.attributes,function(){if(this.status===2||this.status===3){j=b.fn.yiiactiveform.updateInput(this,k,d)||j}});if(i.afterValidateAttribute!==undefined){i.afterValidateAttribute(d,i,k,j)}})}},i.validationDelay)};b.each(e.attributes,function(h,j){if(this.validateOnChange){d.find("#"+this.inputID).change(function(){g(j,false)}).blur(function(){if(j.status!==2&&j.status!==3){g(j,!j.status)}})}if(this.validateOnType){d.find("#"+this.inputID).keyup(function(){if(j.value!==a(b(this))){g(j,false)}})}});if(e.validateOnSubmit){d.on("mouseup keyup",":submit",function(){d.data("submitObject",b(this))});var f=false;d.submit(function(){if(f){f=false;return true}if(e.timer!==undefined){clearTimeout(e.timer)}e.submitting=true;if(e.beforeValidate===undefined||e.beforeValidate(d)){b.fn.yiiactiveform.validate(d,function(j){var h=false;b.each(e.attributes,function(){h=b.fn.yiiactiveform.updateInput(this,j,d)||h});b.fn.yiiactiveform.updateSummary(d,j);if(e.afterValidate===undefined||e.afterValidate(d,j,h)){if(!h){f=true;var i=d.data("submitObject")||d.find(":submit:first");if(i.length){i.click()}else{d.submit()}return}}e.submitting=false})}else{e.submitting=false}return false})}d.bind("reset",function(){setTimeout(function(){b.each(e.attributes,function(){this.status=0;var h=d.find("#"+this.errorID),i=b.fn.yiiactiveform.getInputContainer(this,d);i.removeClass(this.validatingCssClass+" "+this.errorCssClass+" "+this.successCssClass);h.html("").hide();this.value=a(d.find("#"+this.inputID))});d.find("label, :input").each(function(){b(this).removeClass(e.errorCss)});b("#"+e.summaryID).hide().find("ul").html("");if(e.focus!==undefined&&!window.location.hash){d.find(e.focus).focus()}},1)});if(e.focus!==undefined&&!window.location.hash){d.find(e.focus).focus()}})};b.fn.yiiactiveform.getInputContainer=function(d,c){if(d.inputContainer===undefined){return c.find("#"+d.inputID).closest("div")}else{return c.find(d.inputContainer).filter(':has("#'+d.inputID+'")')}};b.fn.yiiactiveform.updateInput=function(i,h,g){i.status=1;var d,j,c=false,f=g.find("#"+i.inputID),e=g.data("settings").errorCss;if(f.length){c=h!==null&&b.isArray(h[i.id])&&h[i.id].length>0;d=g.find("#"+i.errorID);j=b.fn.yiiactiveform.getInputContainer(i,g);j.removeClass(i.validatingCssClass+" "+i.errorCssClass+" "+i.successCssClass);j.find("label, :input").each(function(){b(this).removeClass(e)});if(c){d.html(h[i.id][0]);j.addClass(i.errorCssClass)}else{if(i.enableAjaxValidation||i.clientValidation){j.addClass(i.successCssClass)}}if(!i.hideErrorMessage){d.toggle(c)}i.value=a(f)}return c};b.fn.yiiactiveform.updateSummary=function(h,g){var e=b(h).data("settings"),f="";if(e.summaryID===undefined){return}if(g){var c=[];for(var d in e.attributes){if(e.attributes[d].summary){c.push(e.attributes[d].id)}}b.each(e.attributes,function(){if(b.inArray(this.id,c)!==-1&&b.isArray(g[this.id])){b.each(g[this.id],function(i,k){f=f+"<li>"+k+"</li>"})}})}b("#"+e.summaryID).toggle(f!=="").find("ul").html(f)};b.fn.yiiactiveform.validate=function(d,e,i){var k=b(d),f=k.data("settings"),j=false,h={};b.each(f.attributes,function(){var l,m=[];if(this.clientValidation!==undefined&&(f.submitting||this.status===2||this.status===3)){l=a(k.find("#"+this.inputID));this.clientValidation(l,m,this);if(m.length){h[this.id]=m}}if(this.enableAjaxValidation&&!m.length&&(f.submitting||this.status===2||this.status===3)){j=true}});if(!j||f.submitting&&!b.isEmptyObject(h)){if(f.submitting){setTimeout(function(){e(h)},200)}else{e(h)}return}var c=k.data("submitObject"),g="&"+f.ajaxVar+"="+k.attr("id");if(c&&c.length){g+="&"+c.attr("name")+"="+c.attr("value")}b.ajax({url:f.validationUrl,type:k.attr("method"),data:k.serialize()+g,dataType:"json",success:function(l){if(l!==null&&typeof l==="object"){b.each(f.attributes,function(){if(!this.enableAjaxValidation){delete l[this.id]}});e(b.extend({},h,l))}else{e(h)}},error:function(){if(i!==undefined){i()}}})};b.fn.yiiactiveform.getSettings=function(c){return b(c).data("settings")};b.fn.yiiactiveform.defaults={ajaxVar:"ajax",validationUrl:undefined,validationDelay:200,validateOnSubmit:false,validateOnChange:true,validateOnType:false,hideErrorMessage:false,inputContainer:undefined,errorCss:"error",errorCssClass:"error",successCssClass:"success",validatingCssClass:"validating",summaryID:undefined,timer:undefined,beforeValidateAttribute:undefined,afterValidateAttribute:undefined,beforeValidate:undefined,afterValidate:undefined,focus:undefined,attributes:[]}})(jQuery);